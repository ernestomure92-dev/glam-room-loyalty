<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glam Room - Tarjeta de Lealtad</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Login de Admin -->
    <div id="adminLoginModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeAdminLogin()">&times;</span>
            <h2>üëë Acceso Administrador</h2>
            <input type="email" id="adminEmail" placeholder="Correo electr√≥nico">
            <input type="password" id="adminPassword" placeholder="Contrase√±a">
            <button onclick="loginAdmin()" class="btn-primary">Ingresar</button>
        </div>
    </div>

    <div class="container">
        <!-- Pantalla de Login Cliente -->
        <div id="loginScreen" class="screen active">
            <div class="logo-container">
                <img src="assets/logo.png" alt="Glam Room" class="logo">
            </div>
            <div class="login-box">
                <h2>‚ú® Bienvenida ‚ú®</h2>
                <p>Ingresa tu n√∫mero de tel√©fono para ver tu tarjeta</p>
                <input type="tel" id="phoneInput" placeholder="Ej: 5512345678" maxlength="10">
                <button onclick="login()" class="btn-primary">Ver mi Tarjeta</button>
                <p class="admin-link" onclick="showAdminLogin()">Acceso Administrador</p>
            </div>
        </div>

        <!-- Pantalla de Tarjeta Cliente -->
        <div id="cardScreen" class="screen">
            <div class="card-header">
                <img src="assets/logo.png" alt="Glam Room" class="logo-small">
                <button onclick="logout()" class="btn-logout">Salir</button>
            </div>
            
            <div class="loyalty-card">
                <div class="card-glass">
                    <div class="card-content">
                        <h3>üíï Tarjeta Glam üíï</h3>
                        <p class="client-name" id="clientName">Nombre Cliente</p>
                        <div class="tier-badge" id="tierBadge">Nivel: ‚ú® Bronce</div>
                        <div class="stars-container" id="starsContainer"></div>
                        <p class="progress-text">
                            <span id="currentStars">0</span> / <span id="maxStars">10</span> visitas
                        </p>
                        <div class="next-reward" id="nextReward">
                            Pr√≥xima recompensa: <span id="rewardName">Manicure gratis</span>
                        </div>
                        <div class="reward-status" id="rewardStatus">
                            üéâ ¬°Felicidades! Canjea tu recompensa üéâ
                        </div>
                    </div>
                </div>
            </div>

            <div class="levels-info">
                <h4>Niveles de Membres√≠a</h4>
                <div class="levels-grid">
                    <div class="level-item active" data-tier="bronze">
                        <i class="fas fa-medal"></i>
                        <span>Bronce</span>
                        <small>0-9 ‚≠ê</small>
                    </div>
                    <div class="level-item" data-tier="silver">
                        <i class="fas fa-medal"></i>
                        <span>Plata</span>
                        <small>10-24 ‚≠ê</small>
                    </div>
                    <div class="level-item" data-tier="gold">
                        <i class="fas fa-crown"></i>
                        <span>Oro</span>
                        <small>25-49 ‚≠ê</small>
                    </div>
                    <div class="level-item" data-tier="diamond">
                        <i class="fas fa-gem"></i>
                        <span>Diamante</span>
                        <small>50+ ‚≠ê</small>
                    </div>
                </div>
            </div>

            <div class="quick-actions" id="quickActions">
                <h4>¬øQu√© deseas hacer?</h4>
                <button onclick="initAppointmentBooking()" class="btn-primary">
                    <i class="fas fa-calendar-plus"></i> Agendar Nueva Cita
                </button>
                <button onclick="showMyAppointments()" class="btn-secondary">
                    <i class="fas fa-calendar-alt"></i> Ver mis Citas
                </button>
                <a href="https://www.instagram.com/theglamroom.mx/" target="_blank" class="btn-instagram">
                    <i class="fab fa-instagram"></i> Ver nuestro trabajo
                </a>
            </div>

            <div class="history-section">
                <h4>üìÖ Historial de Visitas</h4>
                <ul id="visitHistory" class="history-list"></ul>
            </div>

            <!-- Secci√≥n Instagram -->
            <div class="instagram-section">
                <h3><i class="fab fa-instagram"></i> S√≠guenos en Instagram</h3>
                <p>@theglamroom.mx</p>
                <div class="instagram-embed">
                    <iframe 
                        src="https://www.instagram.com/theglamroom.mx/embed" 
                        frameborder="0" 
                        scrolling="no" 
                        allowtransparency="true"
                        class="instagram-iframe">
                    </iframe>
                </div>
            </div>
        </div>

        <!-- Pantalla de Agendamiento de Citas -->
        <div id="appointmentScreen" class="screen">
            <div class="card-header">
                <img src="assets/logo.png" alt="Glam Room" class="logo-small">
                <button onclick="backToCard()" class="btn-logout">‚Üê Volver</button>
            </div>

            <div class="appointment-container">
                <h2>üíÖ Agenda tu Cita</h2>
                <p class="subtitle">Elige fecha y hora para tu servicio</p>

                <!-- Paso 1: Seleccionar Servicio -->
                <div class="step" id="step1">
                    <h3>1. ¬øQu√© servicio necesitas?</h3>
                    <div class="services-grid">
                        <div class="service-card" onclick="selectService('manicure', 'Manicure', 60)">
                            <i class="fas fa-hand-sparkles"></i>
                            <span>Manicure</span>
                            <small>60 min</small>
                        </div>
                        <div class="service-card" onclick="selectService('pedicure', 'Pedicure', 60)">
                            <i class="fas fa-shoe-prints"></i>
                            <span>Pedicure</span>
                            <small>60 min</small>
                        </div>
                        <div class="service-card" onclick="selectService('gel', 'U√±as Gel', 90)">
                            <i class="fas fa-gem"></i>
                            <span>U√±as Gel</span>
                            <small>90 min</small>
                        </div>
                        <div class="service-card" onclick="selectService('facial', 'Facial', 45)">
                            <i class="fas fa-spa"></i>
                            <span>Facial</span>
                            <small>45 min</small>
                        </div>
                        <div class="service-card" onclick="selectService('maquillaje', 'Maquillaje', 60)">
                            <i class="fas fa-magic"></i>
                            <span>Maquillaje</span>
                            <small>60 min</small>
                        </div>
                        <div class="service-card" onclick="selectService('peinado', 'Peinado', 45)">
                            <i class="fas fa-wind"></i>
                            <span>Peinado</span>
                            <small>45 min</small>
                        </div>
                    </div>
                </div>

                <!-- Paso 2: Seleccionar Fecha -->
                <div class="step hidden" id="step2">
                    <h3>2. ¬øQu√© d√≠a te gustar√≠a?</h3>
                    <div class="calendar-container">
                        <div class="calendar-header">
                            <button onclick="changeMonth(-1)" class="btn-nav"><i class="fas fa-chevron-left"></i></button>
                            <span id="currentMonth">Enero 2024</span>
                            <button onclick="changeMonth(1)" class="btn-nav"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        <div class="calendar-grid" id="calendarGrid"></div>
                    </div>
                    <button onclick="backToStep(1)" class="btn-secondary">‚Üê Anterior</button>
                </div>

                <!-- Paso 3: Seleccionar Hora -->
                <div class="step hidden" id="step3">
                    <h3>3. ¬øA qu√© hora?</h3>
                    <div class="time-slots" id="timeSlots"></div>
                    <p class="note" id="selectedDateDisplay"></p>
                    <button onclick="backToStep(2)" class="btn-secondary">‚Üê Anterior</button>
                </div>

                <!-- Paso 4: Confirmar -->
                <div class="step hidden" id="step4">
                    <h3>4. Confirma tu cita</h3>
                    <div class="appointment-summary">
                        <div class="summary-item">
                            <span>Servicio:</span>
                            <strong id="summaryService">-</strong>
                        </div>
                        <div class="summary-item">
                            <span>Fecha:</span>
                            <strong id="summaryDate">-</strong>
                        </div>
                        <div class="summary-item">
                            <span>Hora:</span>
                            <strong id="summaryTime">-</strong>
                        </div>
                        <div class="summary-item">
                            <span>Duraci√≥n:</span>
                            <strong id="summaryDuration">-</strong>
                        </div>
                    </div>
                    
                    <div class="whatsapp-confirm">
                        <label>
                            <input type="checkbox" id="whatsappReminder" checked>
                            Recibir recordatorio por WhatsApp
                        </label>
                    </div>

                    <button onclick="confirmAppointment()" class="btn-primary btn-large">
                        <i class="fab fa-whatsapp"></i> Confirmar y Agendar
                    </button>
                    <button onclick="backToStep(3)" class="btn-secondary">‚Üê Anterior</button>
                </div>

                <!-- Confirmaci√≥n Final -->
                <div class="step hidden" id="stepSuccess">
                    <div class="success-message">
                        <i class="fas fa-check-circle"></i>
                        <h3>¬°Cita Agendada!</h3>
                        <p>Te enviamos un WhatsApp con los detalles</p>
                        <div id="appointmentDetails"></div>
                        <button onclick="finishAppointment()" class="btn-primary">Ver mis citas</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pantalla de Mis Citas -->
        <div id="myAppointmentsScreen" class="screen">
            <div class="card-header">
                <h2>üìÖ Mis Citas</h2>
                <button onclick="backToCard()" class="btn-logout">‚Üê Volver</button>
            </div>
            <div class="appointments-list" id="myAppointmentsList"></div>
        </div>

        <!-- Panel Administrador -->
        <div id="adminScreen" class="screen">
            <div class="admin-header">
                <div class="admin-title">
                    <h2>üëë Panel de Control</h2>
                    <span id="adminUserEmail"></span>
                </div>
                <div class="admin-actions-header">
                    <button onclick="showDashboard()" class="btn-nav active" data-tab="dashboard">
                        <i class="fas fa-chart-line"></i> Estad√≠sticas
                    </button>
                    <button onclick="showClients()" class="btn-nav" data-tab="clients">
                        <i class="fas fa-users"></i> Clientes
                    </button>
                    <button onclick="showAdminAppointments()" class="btn-nav" data-tab="appointments">
                        <i class="fas fa-calendar"></i> Citas
                    </button>
                    <button onclick="logoutAdmin()" class="btn-logout">Cerrar Sesi√≥n</button>
                </div>
            </div>

            <!-- Dashboard de Estad√≠sticas -->
            <div id="dashboardTab" class="admin-tab active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <div>
                            <h3 id="totalClients">0</h3>
                            <p>Clientes Totales</p>
                        </div>
                    </div>
                    <div class="stat-card highlight">
                        <i class="fas fa-star"></i>
                        <div>
                            <h3 id="totalVisits">0</h3>
                            <p>Visitas este Mes</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-gift"></i>
                        <div>
                            <h3 id="pendingRewards">0</h3>
                            <p>Recompensas Pendientes</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-crown"></i>
                        <div>
                            <h3 id="vipClients">0</h3>
                            <p>Clientes VIP</p>
                        </div>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-box">
                        <h4>Visitas por Semana</h4>
                        <canvas id="visitsChart"></canvas>
                    </div>
                    <div class="chart-box">
                        <h4>Distribuci√≥n de Niveles</h4>
                        <canvas id="tiersChart"></canvas>
                    </div>
                </div>

                <div class="recent-activity">
                    <h4>Actividad Reciente</h4>
                    <ul id="recentActivityList"></ul>
                </div>
            </div>

            <!-- Gesti√≥n de Clientes -->
            <div id="clientsTab" class="admin-tab">
                <div class="search-section">
                    <div class="search-box">
                        <input type="tel" id="adminPhoneInput" placeholder="Buscar por tel√©fono...">
                        <button onclick="searchClient()" class="btn-primary">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <button onclick="showNewClientForm()" class="btn-success">
                        <i class="fas fa-plus"></i> Nuevo Cliente
                    </button>
                </div>

                <div id="adminClientInfo" class="client-detail-card hidden">
                    <div class="client-header">
                        <div>
                            <h3 id="adminClientName">Cliente</h3>
                            <span id="adminClientPhone" class="phone-tag"></span>
                            <span id="adminClientTier" class="tier-tag">Bronce</span>
                        </div>
                        <div class="client-stats">
                            <div class="stat">
                                <span id="adminClientTotalStars">0</span>
                                <small>Estrellas Totales</small>
                            </div>
                            <div class="stat">
                                <span id="adminClientCurrentStars">0</span>
                                <small>En Tarjeta Actual</small>
                            </div>
                        </div>
                    </div>

                    <div class="progress-bar-container">
                        <div class="progress-bar" id="clientProgressBar"></div>
                        <span id="progressText">0/10</span>
                    </div>

                    <div class="admin-actions">
                        <button onclick="addStar()" class="btn-primary">
                            <i class="fas fa-plus"></i> Agregar Visita
                        </button>
                        <button onclick="redeemReward()" class="btn-reward hidden" id="redeemBtn">
                            <i class="fas fa-gift"></i> Canjear Recompensa
                        </button>
                        <button onclick="sendWhatsAppNotification()" class="btn-whatsapp" id="whatsappBtn">
                            <i class="fab fa-whatsapp"></i> Notificar WhatsApp
                        </button>
                    </div>

                    <div class="client-history">
                        <h5>Historial Completo</h5>
                        <ul id="adminClientHistory"></ul>
                    </div>
                </div>

                <div id="newClientForm" class="form-card hidden">
                    <h4>‚ûï Crear Nuevo Cliente</h4>
                    <input type="text" id="newClientName" placeholder="Nombre completo *">
                    <input type="tel" id="newClientPhone" placeholder="Tel√©fono (10 d√≠gitos) *" maxlength="10">
                    <input type="email" id="newClientEmail" placeholder="Correo (opcional)">
                    <div class="form-actions">
                        <button onclick="createClient()" class="btn-primary">Crear Tarjeta</button>
                        <button onclick="hideNewClientForm()" class="btn-secondary">Cancelar</button>
                    </div>
                </div>
            </div>

            <!-- Gesti√≥n de Citas (Admin) -->
            <div id="appointmentsTab" class="admin-tab">
                <div class="appointments-admin-header">
                    <h3>Citas del D√≠a</h3>
                    <input type="date" id="adminDateFilter" onchange="loadAdminAppointments()">
                </div>
                <div id="adminAppointmentsList" class="admin-appointments-list"></div>
            </div>
        </div>
    </div>

    <!-- Bot√≥n flotante Instagram -->
    <a href="https://www.instagram.com/theglamroom.mx/" target="_blank" class="instagram-float">
        <i class="fab fa-instagram"></i>
    </a>

    <!-- Notificaci√≥n -->
    <div id="notification" class="notification"></div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="js/firebase-config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/whatsapp.js"></script>
    <script src="js/admin-dashboard.js"></script>
    <script src="js/appointments.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
